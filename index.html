function appendBubble(text, who='bot', extras={}){
  const b = document.createElement('div');
  b.className = 'bubble ' + (who==='bot' ? 'from-bot' : 'from-me');

  if(extras.isAudio){
    const audioWrap = document.createElement('div');
    audioWrap.className = 'audio';

    const play = document.createElement('button');
    play.className = 'play';
    play.innerHTML = `
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <polygon points="5 3 19 12 5 21 5 3"></polygon>
      </svg>
      <div class="wave"></div>
      <div class="wave"></div>
      <div class="wave"></div>
    `;

    const audioEl = new Audio(extras.src);

    // Evento de play
    play.addEventListener('click', () => {
      audioEl.play();
      play.disabled = true; 
      play.style.opacity = '0.6';
      appendSuggestions(['Não, quero comprar o curso']);
    });

    // Criar ondas animadas
    const style = document.createElement('style');
    style.innerHTML = `
      .wave {
        display:inline-block;
        width:4px;
        height:12px;
        margin:0 1px;
        background:#fff;
        animation:wave 1s infinite;
      }
      .wave:nth-child(2){animation-delay:0.2s;}
      .wave:nth-child(3){animation-delay:0.4s;}
      @keyframes wave {
        0%,40%,100%{height:4px;}
        20%{height:12px;}
      }
    `;
    document.head.appendChild(style);

    audioWrap.appendChild(play);
    b.appendChild(audioWrap);

  } else if(extras.isCheckout){
    b.innerHTML = `${text}<a class="checkout-link" href="${extras.link}" target="_blank">Clique aqui para comprar</a>`;
    appendSuggestions(['Escolher outras opções']);
  } else {
    b.innerHTML = text.replace(/\n/g,'<br>');
  }

  messagesEl.appendChild(b);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}
